# 什么是TCP
TCP是面向连接的，可靠的，基于字节流的传输层通信协议。
- 面向连接：一定是一对一才能是面向连接，不能像[[UDP]]协议可以一个主机同时向多个主机发送消息，也就是一对多是无法做到的。
- 可靠的：无论网络链路发生了怎么样的变化，TCP都可以保证一个报文一定能够到达接收端。
- 字节流：消息是没有边界的，所以无论我们消息有多大都可以进行传输。

# TCP头部格式
![](https://tva1.sinaimg.cn/large/008eGmZEgy1go9ykh302pj315k0so0wv.jpg)
- 序列号：在建立连接时由计算机生成的随机数作为其初始值，通过SYN包传给接收端主机，每发送一次数据，就累加一次该数据字节数的大小。用来解决网络包乱序问题。
- 确认应答号：指下一次期望收到的数据的序列号，发送端收到这个确认应答以后可以认为在这个序 号以前的数据都已经被正常接收。用来解决不丢包的问题。
- 控制位：
	- ACK：该位为1时，确认应答的字段变为有效，TCP规定除了最初建立连接时的包之外该位必须设置为1。
	- RST：该位为1时，表示TCP连接中出现异常必须强制断开连接。
	- SYN：该位为1时，表示希望建立连接，并在其序列号的字段进行序列号初始值的设定
	- FIN：该位为1时，表示今后不会再有数据发送，希望断开连接。当通信结束希望断开连接时，通信双方的主机之间就可以相互交换FIN位为1的TCP段。

# 为什么需要TCP
因为IP层是不可靠的，他不能保证网络包的交付，不能保证网络包的按序交付，也不能保证数据包的完整性，所以需要有传输层的TCP协议来负责这些功能。

# TCP连接包括哪些内容
- socket：由IP地址和端口号组成
- 序列号：用来解决乱序问题
- 窗口大小：用来做流量控制

# 怎么确定一个TCP连接
在网络中会有很多不同的消息都在同时发送，那么如何标示同一个TCP连接呢？我们可以通过TCP四元组进行标示。他们分别是
- 源地址
- 源端口
- 目的地址
- 目的端口

# TCP最大的连接数
对于IPV4来说，客户端的IP数最多为2的32次方，客户端的端口数最多为2的16次方，也就是服务端单机最大TCP连接数约为2的48(32+16)次方。但是实际上的TCP连接数愿不能达到理论上的上限：
- 文件描述符的限制
- 内存限制

