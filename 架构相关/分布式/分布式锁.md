# 什么是分布式锁
在分布式环境下，锁定全局的唯一资源，使得请求变为串行化，实际使用中表现为互斥锁。

# CAP理论
[[CAP理论]]

# 为什么要使用分布式锁
- 避免不同节点重复相同的工作
- 避免出现多个节点操作同一个资源，导致资源最终状态出错

# 分布式锁的设计目标
- 要保证强一致性
- 要可以实现锁的自动续约以及锁的自动释放

# 分布式锁的设计方案
## redis
内部不包含一致性算法，实现的AP模型，采用主从复制机制实现高可用，表现形式为setNX。

## zookeeper
内部采用paxos算法，实现的CP模型，采用N+1可用的方式，表现形式为createEphemeral。

## etcd
内部采用raft协议，可以实现CP/AP模型，采用N+1可用的方式，对外提供http/grpc接口，表现形式为resuflt api。

# 分布式锁使用的特殊场景
从获得锁到释放锁中间的数据密等等逻辑需要根据业务实践，例如线程A操作订单，先拿到锁，操作之后修改订单状态，然后释放锁。线程B再来操作订单时，可以拿到锁，但是订单状态已经改变了就不进行操作，此时释放锁，通过这样的方式实现数据密等问题。