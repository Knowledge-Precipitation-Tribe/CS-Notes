# 什么是索引
索引是表的目录，在查找内容之前可以先在目录中查找索引位置，以此快速定位查询数据。对于索引，会保存在额外的文件中。  

# 索引的作用
索引是数据库中专门用于帮助用户快速查询数据的一种数据结构，类似于字典中的目录，查找字典内容时可以根据目录查找到数据的存放位置，然后直接获取即可。
- 索引由数据库中一列或多列组合而成，其作用是提高对表中数据的查询速度。
- 索引的优点是可以提高检索数据的速度。
- 索引的缺点是创建和维护索引需要耗费时间。
- 索引可以提高查询速度，会减慢写入速度。

索引本身也很大，不可能全部存储在内存中，因此索引往往索引文件的形式存储在磁盘上。索引查找过程中就要产生磁盘IO消耗，相对于内存存取，IO存取的消耗要高几个数量级。所以评价一个数据结构作为索引的优劣最重要的指标就是在查找过程中磁盘I/O操作次数的渐进复杂度（换句话说，索引的结构组织要尽量减少查找过程中磁盘I/O的存取次数）。

# 索引的种类
B-tree、Hash、R-Tree、全文索引、主键索引、普通索引等。在mysql中索引是在存储引擎层而不是服务器层实现的，所以没有统一的索引标准。
- 普通索引：仅加速查询
- 唯一索引：加速查询+列值唯一。（可以有 null）
- 主键索引：加速查询+列值唯一+表中只有一个（不可以有 null）
- 组合索引：多列值组成一个索引。专门用于组合搜索，其效率大于索引合并
- 全文索引：对文本的内容进行分词，进行搜索

## B-Tree索引
B-Tree不管叶子节点还是非叶子节点，都会保存数据，这样导致在非叶子节点中能保存的指针数量变少，指针少的情况下要保存大量数据，只能增加树的高度，导致IO操作变多，查询性能变低。而每一个页的存储空间是有限的，如果data数据较大时将会导致每个节点（一个页）能存储的key的数量很小，当存储的数据量很大时同样会导致B-Tree的深度较大，增大查询时的磁盘IO次数，进而影响查询效率。

## hash索引
在进行查询操作时，使用hash索引效率很高。因此，当使用一个语句去比较字符然后返回结果集，这样的操作使用hash索引是很快的。

在字符串上创建Hash索引非常好，列值将插入到Hash表中和一个键对应，并和实际的数据行有一个映射关系，也就是该键是一个指向表中数据行的指针。Hash表实际是基于关联数组，假如有一个这样的语句：“boyce = 0×28936”其中0×28936是关联到存储在内存中的boyce。在hash表索引中查找boyce的值并返回内存中的数据，要比检索整个表的列值要快得多。

Hash表不能进行排序的数据结构，Hash表擅长的是键值对，也就是说，检索语句检查相等性。在Hash表中键值是没有排序的，在存储的时候也没有任何的排序规则。因为hash索引不够灵活，所以，hash索引不是默认的索引的数据结构。
- 不是按照索引顺序存储，不能用于排序。
- 不支持部分索引列匹配查找。
- 支持等值查询，不支持范围查询。
- 哈希值冲突多时，不适用。

## 全文索引
全文索引是一种特殊类型的索引，它查找的是文本中的关键词，而不是直接比较索引中的值。全文索引和其他几种索引的匹配方式完全不一样，它更类似于搜索引擎做的事情，而不是简单的 where 条件匹配。可以在相同的列上，同时创建全文索引和B-Tree索引，全文索引适用于Match Against操作，而不是普通的where条件操作。

索引可以包含一个列（即字段）或多个列的值。如果索引包含多个列，一般会将其称作复合索引，此时，列的顺序就十分重要，因为MySQL只能高效的使用索引的最左前缀列。创建一个包含两个列的索引，和创建两个只包含一列的索引是大不相同的。

## B+Tree索引
在B+Tree中，所有数据记录节点都是按照键值大小顺序存放在同一层的叶子节点上，而非叶子节点上只能存储key值信息，这样可以大大加大每个节点存储的key值数量，降低B+Tree的高度，而且每个叶子节点增加一个指向相邻叶子节点的指针，就形成了带有顺序访问指针的B+Tree。做这个优化的目的是为了提高区间访问的性能，例如图中如果要查询key为从18到49的所有数据记录，当找到18后，只需顺着节点和指针顺序遍历就可以一次性访问到所有数据节点，极大提到了区间查询效率。
- B+Tree它的非叶子节点不存储数据，只存储索引，而数据会存放在叶子节点中。
- B+Tree规定：所有的叶子结点包含了全部关键字信息，以及指向含这些关键字记录的指针，且叶子结点本身依关键字的大小自小而大顺序链接。

在InnoDB存储引擎中，数据存放的方式是以页的方式进行存放，计算机在存储数据的时候，有最小存储单元，就是最小数据扇区，一个扇区的大小是512字节，而文件系统(ext4)他的最小单元是块，一个块的大小是4k，而对于我们的InnoDB存储引擎也有自己的最小存储单元---页。一个页的大小是16K。在InnoDB中默认的数据页的大小是16K。

数据库中的B+Tree索引可以分为聚集索引（clustered index）和辅助索引（secondary index）。聚集索引的B+Tree中的叶子节点存放的是整张表的行记录数据。辅助索引与聚集索引的区别在于辅助索引的叶子节点并不包含行记录的全部数据，而是存储相应行数据的聚集索引键，即主键。当通过辅助索引来查询数据时，InnoDB存储引擎会遍历辅助索引找到主键，然后再通过主键在聚集索引中找到完整的行记录数据，所以如果查询辅助索引时需要查询两次索引。

# InnoDB索引实现
InnoDB的数据文件本身就是索引文件，InnoDB中，表数据文件本身就是按B+Tree组织的一个索引结构，这棵树的叶节点data域保存了完整的数据记录，这个索引的key是数据表的主键。InnoDB表都必须有主键，如果没有定义主键，会默认添加一个主键。

一级索引（主键）：
- 如果一个主键被定义了，那么这个主键就是作为聚集索引。
- 如果没有主键被定义，那么该表的第一个唯一非空索引被作为聚集索引。
- 如果没有主键也没有合适的唯一索引，那么InnoDB内部会生成一个隐藏的主键作为聚集索引，这个隐藏的主键是一个6字节的列，该列的值会随着数据的插入自增。

二级索引：
- 以所在的列建立二级索引，然后二级索引的data域则为主键。

# MyISAM 索引实现
MyISAM 索引文件和数据文件是分离的，索引文件仅保存记录所在页的指针，通过这些地址来读取页，进而读取被索引的行。

# InnoDB与MyISAM在B+Tree索引的区别
第一重大的区别是InnoDB的数据文件本身就是索引文件，MyISAM索引文件和数据文件是分离的，索引文件仅仅保存数据记录的地址。

第二个与MyISAM索引的不同是InnoDB的辅助索引data域存储相应记录主键的值而不是地址InnoDB的所有辅助索引都引用主键作为data域。

聚集索引这种实现方式使得按主键的搜索十分高效，但是辅助索引搜索需要检索两遍索引：首先检索辅助索引获得主键，然后用主键到主索引中检索获得记录。

# 为什么MySQL索引要使用B+树而不是其他树形结构
因为B树不管叶子节点还是非叶子节点，都会保存数据，这样导致在非叶子节点中能保存的指针数量变少（有些资料也称为扇出），指针少的情况下要保存大量数据，只能增加树的高度，导致IO操作变多，查询性能变低；红黑树BST的时间复杂度是依赖于树的高度，但是，红黑树的高度与Btree相比，高度更大。

# 参考资料
- []()