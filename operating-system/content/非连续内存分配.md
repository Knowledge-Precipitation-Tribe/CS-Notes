# 什么是非连续内存分配
非连续内存分配**允许一个程序分散的装入到不相邻的内存分区中**，非连续分配管理方式根据分区大小是否固定分为分页存储管理方式和分段存储管理方式，其中分页存储管理方式根据运行作业时是否需要把作业的所有页都装入内存才能运行而分为**基本分页存储管理**和**请求分页存储管理**。

# 基本分页存储管理方式
## 分页原理
在分页存储管理中，用户作业的地址空间被划分为若干个大小相等的区域，称为页或页面。相应的也将主存中的存储空间划分为与页面大小相等的区域，称为快或者物理块。在为作业分配存储空间时，总是以块为单位来分配，可以将作业中的任意一页放到主存的任意一块中。

在调度作业运行时，必须将它的所有页面一次调入主存；若主存中没有足够的物理块，则作业等待。这种存储管理方式称为**简单分页或纯分页**。

页面的大小由机器的地址结构决定。在确定地址结构时，若选择的页面比较小，可使页内碎片较小并减少内存碎片的总空间，有利于提高内存利用率；但也会使每个进程要求较多的页面，从而导致页表过长，占用较多内存，还会降低页面换进换出的效率。若选择的页面较大，虽然可以减少页表长度，提高页面换进换出的效率，但却会使页内碎片增大。

因此，页面的大小应该选择适中（通常为2的整数幂），以方便地址变换，一般为512B～4KB。分页存储管理系统中的逻辑地址包含两部分内容：前一部分为页号P，后一部分为页内位移W（也称为页内偏移量）。

为了将逻辑地址上连续的页号映射到物理内存中后称为离散分布的多个物理块，需要将每个页面和每个物理块一一对应，这种映射关系就体现在**页表**上。页表中每个页表项都由页号和块号组成，根据页表项就可以找到每个页号所对应物理内存中物理块的块号。页表通常存放在内存中。

## 基本地址变换机构
地址变换过程是由硬件自动完成的，页表寄存器PTR用于存放页表在内存中的起始地址和页表长度。
![](https://tva1.sinaimg.cn/large/008eGmZEly1gnt5d06z2ij30ow0ec3zu.jpg)
如上图所示，假设页面大小为L，页表长度为M，逻辑地址为A，物理地址为E，下面列出从逻辑地址A得到物理地址E去访问内存的步骤。
- 计算页号p=(int)(A/L)，页内位移W=A%L
- 比较页号P和页表长度M，若p>=M，则产生越界中断，否则继续向下执行
- 页表其实地址F与页号P和页表项长度的乘积相加，用得到的地址值到内存中取出该内存单元存放的数b，这个b就是物理块号
- 物理块号b和物理块大小的乘积与页内位移W组合称物理地址E
- 用得到的物理地址E去访问内存

## 具有快表的地址变换机构
从上面可以知道，若页表全部存放在主存中，则存取一个数据或一条指令至少要访问两次主存。其中，第一次是通过访问页表以确定所存取的数据或指令的物理地址，第二次才根据所得到的物理地址存取数据或指令。

为了提高地址的变换速度，可以在地址变换机构中增设一个具有并行查找功能的高速缓冲存储器(又称为联想存储器或快表)	，将部分页表项放在这个高速缓冲存储器中。快表(TLB)一般由半导体存储其实现，其工作周期与CPU的周期大致相同，但造价较高。所以通常将正在运行作业当前访问的那些页表项存放在快表中，页表的其他部分仍然存放在内存中。如下图所示
![](https://tva1.sinaimg.cn/large/008eGmZEly1gnt5ahiuebj30j60bdmy2.jpg)

增加快表后的地址变换过程如下：
- 根据逻辑地址得到页号P与页内位移W
- 将页号与TLB中的页号进行对比，若有匹配的页号，则直接读取出对应的块号，与页内位移拼接得到对应的物理地址。若没有匹配的页号，则还需访问内存中的页表，从页表中取出物理块号，与页内位移拼接得到物理地址，并将此次的页表项存储到快表中
- 用得到的物理地址访问内存

## 基本分页存储管理方式的优缺点
- 优点
	- 内存利用率高
	- 实现了离散分配
	- 便于存储访问控制
	- 无外部碎片
- 缺点
	- 需要硬件支持(尤其是快表)
	- 内存访问效率下降
	- 共享困难
	- 无内部碎片

# 基本分段管理方式


