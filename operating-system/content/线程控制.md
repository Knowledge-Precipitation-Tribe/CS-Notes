# 什么是线程
线程的引入提高了程序并发执行的程度，从而进一步提高系统吞吐量。与进程类似，线程也没有一个非常明确的定义，可以将线程理解为进程内一个相对独立的，可调度的执行单元。线程自己基本上不拥有资源，只拥有一点在运行时必不可少的资源(如程序计数器，寄存器和栈)，但它可以与同属一个进程的其他想成共享进程拥有的资源。

多线程是指一个进程中有多个线程，这些线程共享该进程资源。这些线程驻留在相同的地址空间中，共享数据和文件。

# 为什么需要线程
我们尽然已经有进程了为什么还需要线程呢？主要目的是为了减少程序的并发执行时所消耗的时空开销。

为了使进程能并发执行，操作系统必须进行一系列的操作，如创建进程，撤销进程和进程切换。在进行这些操作时，操作系统要为进程分配资源及回收资源，为运行进程保存现场信息，这些工作都需要付出较多的时空开销。

# 线程的实现
在操作系统中有多种方式可以实现对线程的支持。最自然的方法是由操作系统内核提供线程的控制机制。在只有进程概念的操作系统中，可由用户程序利用函数库提供线程的控制机制。还有一种做法是同时在操作系统内核和用户程序两个层次上提供线程控制机制。

**内核级线程**是指以来于内核，由操作系统内核完成创建和撤销工作的线程。早支持内核及线程的操作系统中，内核维护进程和线程的上下文信息并完成线程切换工作。*一个内核级线程由于I/O操作而阻塞时，不会影响其他线程的运行*。这时，处理器时间片分配的对象是线程，所以有多个线程的进程将获得更多处理器时间。

**用户级线程**是指不依赖于操作系统核心，由应用进程利用线程库提供创建，同步，调度和管理线程的函数来控制的线程。由于用户级线程的维护由应用进程完成，不需要操作系统内核了解用户级线程的存在，因此可用于不支持内核级线程的多进程操作系统，甚至是单用户操作系统。用户级线程切换不需要内核特权，用户级线程调度算法可针对应用优化。许多应用软件都有自己的用户级线程。由于用户级线程的调度在应用程序内部进行，通常采用非抢占式和更简单的规则，也无需用户态/内核态的转换，因此速度特别快。*当然，由于操作系统内核不了解用户线程的存在，当一个线程阻塞时，整个进程都必须等待*。这时处理器时间片是分配给进程的，当进程内有多个线程时，每个线程的执行时间相对减少。

有些操作操作系统提供了上述两种方法的组合实现。在这种系统中，内核支持多线程的建立，调度和管理；同时，系统中又提供使用线程库的便利，允许用户应用程序建立，调度和管理用户级线程。

# 多线程模型
有些系统同时支持用户级线程和内核级线程，因此根据用户级线程和内核级线程连接方式的不同产生了三种不同的多线程模型。
## 多对一模型
多对一模型将多个用户级线程映射到一个内核级线程上。在采用该模型的系统中，线程在用户空间进行管理，效率相对较高。但是，由于多个用户级线程映射到一个内核级线程，只要一个用户级线程阻塞，就会导致整个进程阻塞。而且由于系统只能识别一个线程(内核级线程)，因此即使有多处理器，该进程的若干个用户级线程也只能同时运行一个，不能并行执行。

## 一对一模型
一对一模型将内核级线程与用户级线程一一对应。这样做的好处是当一个线程阻塞时，不影响其他线程的运行，因此一对一模型的并发行比多对一模型要好。而且这样做之后，再多处理器上可以实现多线程并行。这种模型的缺点是创建一个用户线程时需要创建一个相应的内核级线程。

## 多对多模型
多对多模型将多个用户级线程映射到多个内核级线程(内核级线程数不多余用户级线程数，内核级线程根据具体情况确定)。采用这样的模型可以打破前两种模型对用户级线程的限制，不仅可以使多个用户级线程真正意义上并行执行，而且不会限制用户级线程数量。用户可以自由创建所需的用户级线程，多个内核级线程根据需要调用用户级线程，当一个用户级线程阻塞时，可以调度执行其他线程。

# 进程与线程的区别
- **调度**。在传统的操作系统中，用于资源和独立调度的基本单位都是进程。*而在引入线程的操作系统中，线程是独立调度的基本单位，进程是拥有资源的基本单位*。在同一进程中，线程的切换不会引起进程切换。在不同进程中进行线程切换，将会引起进程切换。
- **拥有资源**。无论是传统操作系统还是设有线程的操作系统，进程都是拥有资源的基本单位，而线程不拥有系统资源，但线程可以访问其隶属进程的系统资源。
- **并发性**。在引入线程的操作系统中，不仅进程之间可以并发执行，而且统一进程内的多个线程之间也可以并发执行。这使得操作系统具有更好的并发性，大大提高了系统的吞吐量。
- **系统开销**。由于创建进程或撤销进程时，系统都要为之分配或回收资源，如内存空间I/O设备等，操作系统所付出的开销远大于创建或撤销线程时的开销。类似的，在进行进程切换时，设计整个当前进程CPU环境的保存及新调度到进程的CPU环境的设置，而线程切换时，只需保存和设置少量寄存器内容，因此开销很小。另外，由于同一进程内的多个线程共享进程的地址空间，因此，多线程之间的同步与通信非常容易实现，甚至无需操作系统的干预。