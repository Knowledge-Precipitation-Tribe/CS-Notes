分页存储管理方式虽然解决了内存中的外部碎片问题，但它要求将作业的所有页面一次性调入主存，但是当主存空间不足时，就会限制一些作业进入主存执行。

所以就产生了请求分页存储管理方式，先将程序部分装入内存执行，当需要其他部分时再调入内存，可以看到这种方法是根据程序的局部性原理产生的。

# 请求分页原理
请求分页存储管理方法在作业地址空间的分页，存储空间的分块等概念上与分页存储管理完全一样。它是在分页存储管理上，通过增加请求调页功能，页面置换功能所形成的一种虚拟存储系统。

在请求分页存储管理中，作业运行之前，只需要将当前需要的一部分页面装入主存，便可以启动作业运行。在作业运行过程中，若要访问的页面不在主存中，则通过调页功能将其调入，同时还可以通过置换功能将暂时用不到的页面换到外存上，以便腾出存储空间。

# 页表结构
在请求分页系统中使用的主要数据结构仍然是页表，其基本作用是将地址空间中的逻辑地址转换为内存空间中的物理地址。由于请求分页是将分页系统中的一部分调入内存，还有一部分存放在磁盘上，所以需要在页表中增加一些字段，以供操作系统在实现页面的调入，换出等。页表中存在以下几个字段：
- 页号和物理块号
- 状态位：用于判断页面是否存在主存中。每当进行主存访问时，根据该位判断要访问的页面是否在主存中，若不在主存中，则产生缺页中断。
- 访问字段：用于记录页面在一段时间内被访问的次数，或最近已经有多久没有被访问，以供置换算法在选择换出页面时进行参考。
- 修改位：用于表示页面调入内存后是否被修改过，当处理器以写方式访问页面时，系统将设置该页面的修改位。由于内存中的页面在外存上都有副本，因此，若页面未被修改过，则在该页面置换出时不需要将页面写到外存，以减少磁盘写的次数；若页面被修改，则需要将其重新写到外存中。
- 外存地址：用于指出页面在外存上的存放地址，供调入页面时使用。

# 缺页中断与地址变换
在请求分页存储管理系统中，若所访问的页面在内存中，其地址变换过程与分页存储管理相同；若访问的页面不在内存，则应先将该页面调入内存，再按照与基本分页存储管理相同的方式进行地址变换。

若系统发现所要访问的页面不在内存中，便会产生一个缺页中断信号，此时用户程序被中断，控制转到操作系统的缺页中断处理程序，将在外存的页调入内存。

在调页过程中，若内存中有空闲空间，则缺页中断处理程序只需把缺页装入任何一个空闲存储块中，再修改页表中的相应字段。若内存中无空闲空间，则必须先淘汰内存中的某些页面，若被淘汰页曾被修改过，则要将其写回外存。流程图如下：
![](https://tva1.sinaimg.cn/large/008eGmZEly1go06ws9iaej30qb0fnn1x.jpg)

缺页中断是一个比较特殊的中断，它与一般的中断相比有着明显的区别，主要表现如下：
- 在指令的执行期间产生和处理缺页中断。通常，CPU是在指令执行完毕后检查是否有中断请求到达，若有则进行相应。而缺页中断是在一条指令的执行期间发现要访问的指令和数据不在内存时产生和处理的。
- 一条指令可以产生多个缺页中断

# 请求分页管理方式的优缺点
优点：
- 可以离散存储程序，降低了碎片数量
- 提供虚拟存储器，提高了主存利用率，有利于多道程序运行，方便用户

缺点：
- 必须有硬件支持
- 有些情况下系统回产生抖动现象
- 程序最后一页仍然存在未被利用的部分空间

